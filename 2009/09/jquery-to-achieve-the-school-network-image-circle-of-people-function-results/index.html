<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml">
<head>
    <title>jQuery图片圈人功能在ASP.NET下的改进</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Open Graph tags -->

            <meta property="og:type" content="article"/>
            <meta property="og:title" content="jQuery图片圈人功能在ASP.NET下的改进"/>
            <meta property="og:url" content="/2009/09/jquery-to-achieve-the-school-network-image-circle-of-people-function-results/"/>
            <meta property="og:description" content="项目中需要一个类似于校内圈人效果的js控件，找了一下基本没有直接能用的，只有一些未完成，我只能自己动手了。 基本框架参照这篇文章《JS实现校内网"图片圈人 "功能效果》（强烈推荐这篇 文章，这段代码写的很帅气） 我把代码摘录如下，不过还是建议大家去看原文的一些分析。 原始Code: 运行环境： 1.jQuery支持 2.DragResize类（czy1121作者写的一个js类，更多信息可以参照《Javascript Resize和Dr ag类,基于jQuery》 ） 样式： #enclose-wrapper { position: relative; z-index: 0; border: 4px solid #DDD; background-color: #FFF; } #form-add-tag { margin-left: 8px; position: absolute; padding: 5px 3px; border: 1px solid #005EAC; float ..."/>

    <!-- Bootstrap -->
        <link rel="stylesheet" href="/theme/css/bootstrap.min.css" type="text/css"/>
    <link href="/theme/css/font-awesome.min.css" rel="stylesheet">
    <link href="/theme/css/pygments.css" rel="stylesheet">
    <link rel="stylesheet" href="/theme/css/style.css" type="text/css"/>
    <!-- JavaScript plugins (requires jQuery) -->
    <script src="http://code.jquery.com/jquery.js"></script>


    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-8822123-3']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();

    </script>
</head>
<body>
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="/" class="navbar-brand">Log4D</a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                    <li><a href="/tags/">Tags</a></li>
                    <li><a href="/links/">Links</a></li>
                    <li><a href="/about/">About</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="/archives/"><i class="icon-th-list"></i>Archives</a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</nav>
<!-- /.navbar -->
<div class="container">
    <div class="row">
        <div class="col-lg-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="/2009/09/jquery-to-achieve-the-school-network-image-circle-of-people-function-results/"
                       rel="bookmark"
                       title="Permalink to jQuery图片圈人功能在ASP.NET下的改进">
                        jQuery图片圈人功能在ASP.NET下的改进
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="icon-calendar"></i>2009-09-02
    </span>



<span class="label label-default">Tags</span>
	<a href="/tag/javascript/">JavaScript</a>
        /
	<a href="/tag/jquery/">jQuery</a>
        /
	<a href="/tag/ren-ren/">人人</a>
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>项目中需要一个类似于校内圈人效果的js控件，找了一下基本没有直接能用的，只有一些未完成，我只能自己动手了。 基本框架参照这篇文章《<a href="http://www.cnblogs.com/czy1121/archive/2009/03/03/1402105.html">JS实现校内网"图片圈人
"功能效果</a>》（强烈推荐这篇
文章，这段代码写的很帅气） 我把代码摘录如下，不过还是建议大家去看原文的一些分析。</p>
<h2>原始Code:</h2>
<p>运行环境： 1.jQuery支持 2.DragResize类（czy1121作者写的一个js类，更多信息可以参照《<a href="http://www.cnblogs.com/czy1121/archive/2009/02/26/1398971.html">Javascript Resize和Dr
ag类,基于jQuery</a>》
）</p>
<h3>样式：</h3>
<div class="highlight"><pre><span class="nf">#enclose-wrapper</span> <span class="p">{</span>
    <span class="k">position</span><span class="o">:</span> <span class="k">relative</span><span class="p">;</span>
    <span class="k">z-index</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span>
    <span class="k">border</span><span class="o">:</span> <span class="m">4px</span> <span class="k">solid</span> <span class="m">#DDD</span><span class="p">;</span>
    <span class="k">background-color</span><span class="o">:</span> <span class="m">#FFF</span><span class="p">;</span>
<span class="p">}</span>
<span class="nf">#form-add-tag</span> <span class="p">{</span>
    <span class="k">margin-left</span><span class="o">:</span> <span class="m">8px</span><span class="p">;</span>
    <span class="k">position</span><span class="o">:</span> <span class="k">absolute</span><span class="p">;</span>
    <span class="k">padding</span><span class="o">:</span> <span class="m">5px</span> <span class="m">3px</span><span class="p">;</span>
    <span class="k">border</span><span class="o">:</span> <span class="m">1px</span> <span class="k">solid</span> <span class="m">#005EAC</span><span class="p">;</span>
    <span class="k">float</span><span class="o">:</span> <span class="k">left</span><span class="p">;</span>
    <span class="k">display</span><span class="o">:</span> <span class="k">inline</span><span class="p">;</span>
    <span class="k">background-color</span><span class="o">:</span> <span class="m">#FFF</span><span class="p">;</span>
<span class="p">}</span>
<span class="nf">#select-area-box</span> <span class="p">{</span>
    <span class="k">position</span><span class="o">:</span> <span class="k">absolute</span><span class="p">;</span>
    <span class="k">border</span><span class="o">:</span> <span class="m">5px</span> <span class="k">solid</span> <span class="m">#D8DFEA</span><span class="p">;</span>
    <span class="k">float</span><span class="o">:</span> <span class="k">left</span><span class="p">;</span>
<span class="p">}</span>
<span class="nf">#select-area</span> <span class="p">{</span>
    <span class="k">position</span><span class="o">:</span> <span class="k">relative</span><span class="p">;</span>
    <span class="k">padding</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span>
    <span class="k">border</span><span class="o">:</span> <span class="m">2px</span> <span class="k">solid</span> <span class="m">#005EAC</span><span class="p">;</span>
    <span class="k">z-index</span><span class="o">:</span> <span class="m">15</span><span class="p">;</span>
    <span class="k">cursor</span><span class="o">:</span> <span class="n">move</span><span class="p">;</span>
    <span class="k">background</span><span class="o">:</span> <span class="sx">url(spacer.gif)</span> <span class="k">no-repeat</span> <span class="m">-1px</span> <span class="m">-1px</span><span class="p">;</span>
<span class="p">}</span>
<span class="nf">#select-area-box</span> <span class="nt">span</span> <span class="p">{</span>
    <span class="k">position</span><span class="o">:</span> <span class="k">absolute</span><span class="p">;</span>
    <span class="k">border</span><span class="o">:</span> <span class="m">1px</span> <span class="k">solid</span> <span class="m">#005EAC</span><span class="p">;</span>
    <span class="k">width</span><span class="o">:</span> <span class="m">8px</span><span class="p">;</span>
    <span class="k">height</span><span class="o">:</span> <span class="m">8px</span><span class="p">;</span>
    <span class="k">background-color</span><span class="o">:</span> <span class="m">#FFF</span><span class="p">;</span>
    <span class="k">font-size</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span>
    <span class="k">z-index</span><span class="o">:</span> <span class="m">18</span><span class="p">;</span>
<span class="p">}</span>
<span class="nf">#select-area-box</span> <span class="nt">span</span><span class="nc">.north-west-resize</span> <span class="p">{</span>
    <span class="k">cursor</span><span class="o">:</span> <span class="k">nw-resize</span><span class="p">;</span>
    <span class="k">left</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span>
    <span class="k">top</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span>
    <span class="k">margin-left</span><span class="o">:</span> <span class="m">-1px</span><span class="p">;</span>
    <span class="k">margin-top</span><span class="o">:</span> <span class="m">-1px</span><span class="p">;</span>
<span class="p">}</span>
<span class="nf">#select-area-box</span> <span class="nt">span</span><span class="nc">.north-east-resize</span> <span class="p">{</span>
    <span class="k">cursor</span><span class="o">:</span> <span class="k">ne-resize</span><span class="p">;</span>
    <span class="k">right</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span>
    <span class="k">top</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span>
    <span class="k">margin-right</span><span class="o">:</span> <span class="m">-1px</span><span class="p">;</span>
    <span class="k">margin-top</span><span class="o">:</span> <span class="m">-1px</span><span class="p">;</span>
<span class="p">}</span>
<span class="nf">#select-area-box</span> <span class="nt">span</span><span class="nc">.south-west-resize</span> <span class="p">{</span>
    <span class="k">cursor</span><span class="o">:</span> <span class="k">sw-resize</span><span class="p">;</span>
    <span class="k">left</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span>
    <span class="k">bottom</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span>
    <span class="k">margin-left</span><span class="o">:</span> <span class="m">-1px</span><span class="p">;</span>
    <span class="k">margin-bottom</span><span class="o">:</span> <span class="m">-1px</span><span class="p">;</span>
<span class="p">}</span>
<span class="nf">#select-area-box</span> <span class="nt">span</span><span class="nc">.south-east-resize</span> <span class="p">{</span>
    <span class="k">cursor</span><span class="o">:</span> <span class="k">se-resize</span><span class="p">;</span>
    <span class="k">right</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span>
    <span class="k">bottom</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span>
    <span class="k">margin-right</span><span class="o">:</span> <span class="m">-1px</span><span class="p">;</span>
    <span class="k">margin-bottom</span><span class="o">:</span> <span class="m">-1px</span><span class="p">;</span>
<span class="p">}</span>
<span class="nf">#enclose-wrapper</span> <span class="nt">ul</span><span class="nf">#tag-list</span> <span class="p">{</span>
    <span class="k">list-style</span><span class="o">:</span> <span class="k">none</span><span class="p">;</span>
    <span class="k">margin</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span>
    <span class="k">padding</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span>
    <span class="k">font-size</span><span class="o">:</span> <span class="m">13px</span><span class="p">;</span>
    <span class="k">float</span><span class="o">:</span> <span class="k">left</span><span class="p">;</span>
<span class="p">}</span>
<span class="nf">#enclose-wrapper</span> <span class="nt">ul</span><span class="nf">#tag-list</span> <span class="nt">li</span> <span class="p">{</span>
    <span class="k">list-style</span><span class="o">:</span> <span class="k">none</span><span class="p">;</span>
    <span class="k">float</span><span class="o">:</span> <span class="k">left</span><span class="p">;</span>
<span class="p">}</span>
<span class="nf">#enclose-wrapper</span> <span class="nt">ul</span><span class="nf">#tag-list</span> <span class="nt">li</span> <span class="nt">a</span> <span class="p">{</span>
    <span class="k">color</span><span class="o">:</span> <span class="m">#F60</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<h3>js实现代码：</h3>
<div class="highlight"><pre><span class="kd">var</span> <span class="nx">photoTag</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">show</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">left</span><span class="p">,</span> <span class="nx">top</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">,</span> <span class="nx">show_resize_square</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#select-area-box&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">({</span>
            <span class="s1">&#39;left&#39;</span><span class="o">:</span> <span class="nx">left</span> <span class="o">-</span> <span class="mi">7</span><span class="p">,</span>
            <span class="s1">&#39;top&#39;</span><span class="o">:</span> <span class="nx">top</span> <span class="o">-</span> <span class="mi">7</span>
        <span class="p">})</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#select-area-box&#39;</span><span class="p">).</span><span class="nx">width</span><span class="p">(</span><span class="nx">width</span> <span class="o">+</span> <span class="mi">4</span><span class="p">).</span><span class="nx">height</span><span class="p">(</span><span class="nx">height</span> <span class="o">+</span> <span class="mi">4</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#select-area&#39;</span><span class="p">).</span><span class="nx">width</span><span class="p">(</span><span class="nx">width</span><span class="p">).</span><span class="nx">height</span><span class="p">(</span><span class="nx">height</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">show_resize_square</span><span class="p">)</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#select-area-box span&#39;</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
        <span class="k">else</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#select-area-box span&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="nx">hide</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#select-area-box&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="nx">add</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">tag_name</span><span class="p">,</span> <span class="nx">tag_value</span><span class="p">,</span> <span class="nx">left</span><span class="p">,</span> <span class="nx">top</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">json</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">id</span><span class="o">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">10000</span><span class="p">)</span>
        <span class="p">};</span>
        <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">left</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nx">top</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nx">width</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nx">height</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">li</span> <span class="o">=</span> <span class="s1">&#39;</span>

<span class="s1">  * &#39;</span><span class="p">;</span>         <span class="nx">li</span> <span class="o">+=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>         <span class="nx">li</span> <span class="o">+=</span> <span class="s1">&#39;(</span><span class="cp">[</span><span class="err">删除</span><span class="cp">]</span><span class="s1">(javascript:;))&#39;</span><span class="p">;</span>         <span class="nx">li</span> <span class="o">+=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>         <span class="nx">li</span> <span class="o">+=</span> <span class="s1">&#39;</span>
<span class="s1">&#39;</span><span class="p">;</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#tag-list&#39;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">li</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">remove</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">li</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">li</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">li</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>
<span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">is_started</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="c1">// 选区左上角,和高宽</span>
    <span class="kd">var</span> <span class="nx">info</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;left&#39;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;top&#39;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;width&#39;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;height&#39;</span><span class="o">:</span> <span class="mi">0</span>
    <span class="p">};</span>
    <span class="kd">var</span> <span class="nx">origin</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">x</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#enclose-wrapper&#39;</span><span class="p">).</span><span class="nx">offset</span><span class="p">().</span><span class="nx">left</span> <span class="o">+</span> <span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#enclose-wrapper&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;border-left-width&#39;</span><span class="p">))</span> <span class="o">||</span> <span class="mi">0</span><span class="p">),</span>
        <span class="nx">y</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#enclose-wrapper&#39;</span><span class="p">).</span><span class="nx">offset</span><span class="p">().</span><span class="nx">top</span> <span class="o">+</span> <span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#enclose-wrapper&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;border-top-width&#39;</span><span class="p">))</span> <span class="o">||</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">};</span>
    <span class="kd">var</span> <span class="nx">dnr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DragResize</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#select-area-box&#39;</span><span class="p">)</span><span class="cp">[</span><span class="mi">0</span><span class="cp">]</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">minWidth</span><span class="o">:</span> <span class="mi">20</span><span class="p">,</span>
        <span class="nx">minHeight</span><span class="o">:</span> <span class="mi">20</span><span class="p">,</span>
        <span class="nx">bound</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">left</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="nx">top</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="nx">right</span><span class="o">:</span> <span class="mi">9999</span><span class="p">,</span>
            <span class="nx">bottom</span><span class="o">:</span> <span class="mi">9999</span>
        <span class="p">},</span>
        <span class="nx">callback</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// 7为左(上)边两个边框的宽度的和, 4为左右(上下)篮色边框宽度的和</span>
            <span class="nx">info</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;left&#39;</span><span class="o">:</span> <span class="nx">i</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="mi">7</span><span class="p">,</span>
                <span class="s1">&#39;top&#39;</span><span class="o">:</span> <span class="nx">i</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="mi">7</span><span class="p">,</span>
                <span class="s1">&#39;width&#39;</span><span class="o">:</span> <span class="nx">i</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="mi">4</span><span class="p">,</span>
                <span class="s1">&#39;height&#39;</span><span class="o">:</span> <span class="nx">i</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="mi">4</span>
            <span class="p">};</span>
            <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#select-area&#39;</span><span class="p">).</span><span class="nx">width</span><span class="p">(</span><span class="nx">info</span><span class="p">.</span><span class="nx">width</span><span class="p">).</span><span class="nx">height</span><span class="p">(</span><span class="nx">info</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
            <span class="c1">// 将添加标签的表单定位在选区的右边</span>
            <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#form-add-tag&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">({</span>
                <span class="s1">&#39;left&#39;</span><span class="o">:</span> <span class="nx">i</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="nx">i</span><span class="p">.</span><span class="nx">width</span> <span class="o">+</span> <span class="mi">10</span><span class="p">,</span>
                <span class="s1">&#39;top&#39;</span><span class="o">:</span> <span class="nx">i</span><span class="p">.</span><span class="nx">top</span>
            <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">});</span>
    <span class="c1">// 拖动选区</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#select-area&#39;</span><span class="p">).</span><span class="nx">mousedown</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">dnr</span><span class="p">.</span><span class="nx">drag</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="c1">// 调整选区大小</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#select-area-box span&#39;</span><span class="p">).</span><span class="nx">mousedown</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">dnr</span><span class="p">.</span><span class="nx">resize</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">className</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;-resize&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">));</span>
    <span class="p">});</span>
    <span class="c1">// 在图片上点击一下,开始获取选区</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#photo-wrapper img&#39;</span><span class="p">).</span><span class="nx">mousedown</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">is_started</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="nx">is_started</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">left</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">pageX</span> <span class="o">-</span> <span class="nx">origin</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="mi">50</span> <span class="o">-</span> <span class="mi">7</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">top</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">pageY</span> <span class="o">-</span> <span class="nx">origin</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="mi">50</span> <span class="o">-</span> <span class="mi">7</span><span class="p">;</span>
        <span class="nx">info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;left&#39;</span><span class="o">:</span> <span class="nx">left</span> <span class="o">+</span> <span class="mi">7</span><span class="p">,</span>
            <span class="s1">&#39;top&#39;</span><span class="o">:</span> <span class="nx">top</span> <span class="o">+</span> <span class="mi">7</span><span class="p">,</span>
            <span class="s1">&#39;width&#39;</span><span class="o">:</span> <span class="mi">100</span><span class="p">,</span>
            <span class="s1">&#39;height&#39;</span><span class="o">:</span> <span class="mi">100</span>
        <span class="p">};</span>
        <span class="nx">photoTag</span><span class="p">.</span><span class="nx">show</span><span class="p">(</span><span class="nx">info</span><span class="p">.</span><span class="nx">left</span><span class="p">,</span> <span class="nx">info</span><span class="p">.</span><span class="nx">top</span><span class="p">,</span> <span class="nx">info</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">info</span><span class="p">.</span><span class="nx">height</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#form-add-tag&#39;</span><span class="p">).</span><span class="nx">show</span><span class="p">().</span><span class="nx">css</span><span class="p">({</span>
            <span class="s1">&#39;left&#39;</span><span class="o">:</span> <span class="nx">left</span> <span class="o">+</span> <span class="mi">100</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">10</span><span class="p">,</span>
            <span class="s1">&#39;top&#39;</span><span class="o">:</span> <span class="nx">top</span>
        <span class="p">});</span>
    <span class="p">});</span>
    <span class="c1">// 鼠标进入图片内时,显示选区</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#photo-wrapper img&#39;</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;mouseenter&#39;</span><span class="p">,</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">is_started</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="nx">photoTag</span><span class="p">.</span><span class="nx">show</span><span class="p">(</span><span class="nx">info</span><span class="p">.</span><span class="nx">left</span><span class="p">,</span> <span class="nx">info</span><span class="p">.</span><span class="nx">top</span><span class="p">,</span> <span class="nx">info</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">info</span><span class="p">.</span><span class="nx">height</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="c1">// 确定添加一个标签,或取消</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#btn-add-tag, #btn-cancel&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">==</span> <span class="s1">&#39;btn-cancel&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#form-add-tag, #select-area-box&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
            <span class="nx">is_started</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#tag-name&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">())</span> <span class="p">{</span>
            <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;标签名不能为空！&#39;</span><span class="p">);</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="c1">// 添加标签</span>
        <span class="nx">photoTag</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#tag-name&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#tag-value&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span> <span class="nx">info</span><span class="p">.</span><span class="nx">left</span><span class="p">,</span> <span class="nx">info</span><span class="p">.</span><span class="nx">top</span><span class="p">,</span> <span class="nx">info</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">info</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
        <span class="c1">// 隐藏选区和表单</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#form-add-tag, #select-area-box&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
        <span class="nx">is_started</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">});</span>
    <span class="nx">photoTag</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>


<h3>Html代码</h3>
<div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;enclose-wrapper&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;photo-wrapper&quot;</span> <span class="na">style=</span><span class="s">&quot;margin:15px auto;text-align:center;&quot;</span><span class="nt">&gt;</span> <span class="nt">&lt;img</span> <span class="na">id=</span><span class="s">&quot;photo&quot;</span> <span class="na">src=</span><span class="s">&quot;heroes_s3_peter.jpg&quot;</span> <span class="nt">/&gt;</span> <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div&gt;</span>
    <span class="nt">&lt;ul</span> <span class="na">id=</span><span class="s">&quot;tag-list&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;li&gt;</span>相片中：<span class="nt">&lt;/li&gt;</span>
      <span class="nt">&lt;li&gt;</span> <span class="nt">&lt;span</span> <span class="na">onmouseover=</span><span class="s">&quot;photoTag.show(0,0,85,66);&quot;</span> <span class="na">onmouseout=</span><span class="s">&quot;photoTag.hide();&quot;</span><span class="nt">&gt;</span>aaa<span class="nt">&lt;/span&gt;</span> (<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;javascript:;&quot;</span> <span class="na">onclick=</span><span class="s">&quot;photoTag.remove(&#39;342&#39;,this.parentNode);&quot;</span> <span class="na">onmouseover=</span><span class="s">&quot;photoTag.show(0,0,85,66);&quot;</span> <span class="na">onmouseout=</span><span class="s">&quot;photoTag.hide();&quot;</span><span class="nt">&gt;</span>删除<span class="nt">&lt;/a&gt;</span>) <span class="nt">&lt;/li&gt;</span>
    <span class="nt">&lt;/ul&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;select-area-box&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;select-area&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
    <span class="nt">&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;</span> <span class="nt">&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;</span> <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;form-add-tag&quot;</span> <span class="na">style=</span><span class="s">&quot;display:none;&quot;</span><span class="nt">&gt;</span> 输入标签：
</pre></div>


<p><input id="tag-name" name="tag-name" type="text" /></p>
<p><button id="btn-add-tag" type="button">确认</button></p>
<p><button id="btn-cancel" type="button">取消</button></p>
</div>

</div>

<h2>改进</h2>
<p>在Asp.NET下这段代码存在几个问题（毕竟这段代码应该只能算是Demo）：1.无法和服务器进行数据交互。2.无法在ASP.NET环境下获取相关id。3.只
能提交到服务器一个"标签"，不足以完成需求。</p>
<h3>修改后js:</h3>
<div class="highlight"><pre><span class="kd">var</span> <span class="nx">photoTag</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">show</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">left</span><span class="p">,</span> <span class="nx">top</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">,</span> <span class="nx">show_resize_square</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#select-area-box&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">({</span>
            <span class="s1">&#39;left&#39;</span><span class="o">:</span> <span class="nx">left</span> <span class="o">-</span> <span class="mi">7</span><span class="p">,</span>
            <span class="s1">&#39;top&#39;</span><span class="o">:</span> <span class="nx">top</span> <span class="o">-</span> <span class="mi">7</span>
        <span class="p">})</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#select-area-box&#39;</span><span class="p">).</span><span class="nx">width</span><span class="p">(</span><span class="nx">width</span> <span class="o">+</span> <span class="mi">4</span><span class="p">).</span><span class="nx">height</span><span class="p">(</span><span class="nx">height</span> <span class="o">+</span> <span class="mi">4</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#select-area&#39;</span><span class="p">).</span><span class="nx">width</span><span class="p">(</span><span class="nx">width</span><span class="p">).</span><span class="nx">height</span><span class="p">(</span><span class="nx">height</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">show_resize_square</span><span class="p">)</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#select-area-box span&#39;</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
        <span class="k">else</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#select-area-box span&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="nx">hide</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#select-area-box&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="nx">add</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">tag_name</span><span class="p">,</span> <span class="nx">tag_value</span><span class="p">,</span> <span class="nx">left</span><span class="p">,</span> <span class="nx">top</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">json</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">id</span><span class="o">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">10000</span><span class="p">)</span>
        <span class="p">};</span>
        <span class="c1">//$.getJSON(&#39;add_tag.php&#39;, {&#39;name&#39;:tag_name,&#39;left&#39;:left,&#39;top&#39;:top,&#39;width&#39;:width,&#39;height&#39;:height}, function(json) {</span>
        <span class="c1">//reflesh tag list</span>
        <span class="c1">//    if(json.message) alert(json.message);</span>
        <span class="c1">//    if(json.error == 0) {</span>
        <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">left</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nx">top</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nx">width</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nx">height</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">li</span> <span class="o">=</span> <span class="s1">&#39;</span>

<span class="s1">  * &#39;</span><span class="p">;</span>         <span class="nx">li</span> <span class="o">+=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>         <span class="nx">li</span> <span class="o">+=</span> <span class="s1">&#39;(</span><span class="cp">[</span><span class="err">删除</span><span class="cp">]</span><span class="s1">(javascript:;))&#39;</span><span class="p">;</span>         <span class="nx">li</span> <span class="o">+=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>         <span class="nx">li</span> <span class="o">+=</span> <span class="s1">&#39;</span>
<span class="s1">&#39;</span><span class="p">;</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#tag-list&#39;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">li</span><span class="p">);</span>
        <span class="c1">//    }</span>
        <span class="c1">//});</span>
    <span class="p">},</span>
    <span class="nx">remove</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">li</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//$.getJSON(&#39;remove_tag.php&#39;, {&#39;tag_id&#39;:id}, function(json) {</span>
        <span class="c1">//reflesh tag list</span>
        <span class="c1">//    if(json.message) alert(json.message);</span>
        <span class="c1">//    if(json.error == 0)</span>
        <span class="nx">li</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">li</span><span class="p">);</span>
        <span class="c1">//});</span>
    <span class="p">}</span>
<span class="p">};</span>
<span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">is_started</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="c1">// 选区左上角,和高宽</span>
    <span class="kd">var</span> <span class="nx">info</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;left&#39;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;top&#39;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;width&#39;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;height&#39;</span><span class="o">:</span> <span class="mi">0</span>
    <span class="p">};</span>
    <span class="kd">var</span> <span class="nx">origin</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">x</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#enclose-wrapper&#39;</span><span class="p">).</span><span class="nx">offset</span><span class="p">().</span><span class="nx">left</span> <span class="o">+</span> <span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#enclose-wrapper&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;border-left-width&#39;</span><span class="p">))</span> <span class="o">||</span> <span class="mi">0</span><span class="p">),</span>
        <span class="nx">y</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#enclose-wrapper&#39;</span><span class="p">).</span><span class="nx">offset</span><span class="p">().</span><span class="nx">top</span> <span class="o">+</span> <span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#enclose-wrapper&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;border-top-width&#39;</span><span class="p">))</span> <span class="o">||</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">};</span>
    <span class="kd">var</span> <span class="nx">dnr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DragResize</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#select-area-box&#39;</span><span class="p">)</span><span class="cp">[</span><span class="mi">0</span><span class="cp">]</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">minWidth</span><span class="o">:</span> <span class="mi">20</span><span class="p">,</span>
        <span class="nx">minHeight</span><span class="o">:</span> <span class="mi">20</span><span class="p">,</span>
        <span class="nx">bound</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">left</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="nx">top</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="nx">right</span><span class="o">:</span> <span class="mi">9999</span><span class="p">,</span>
            <span class="nx">bottom</span><span class="o">:</span> <span class="mi">9999</span>
        <span class="p">},</span>
        <span class="nx">callback</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// 7为左(上)边两个边框的宽度的和, 4为左右(上下)篮色边框宽度的和</span>
            <span class="nx">info</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;left&#39;</span><span class="o">:</span> <span class="nx">i</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="mi">7</span><span class="p">,</span>
                <span class="s1">&#39;top&#39;</span><span class="o">:</span> <span class="nx">i</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="mi">7</span><span class="p">,</span>
                <span class="s1">&#39;width&#39;</span><span class="o">:</span> <span class="nx">i</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="mi">4</span><span class="p">,</span>
                <span class="s1">&#39;height&#39;</span><span class="o">:</span> <span class="nx">i</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="mi">4</span>
            <span class="p">};</span>
            <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#select-area&#39;</span><span class="p">).</span><span class="nx">width</span><span class="p">(</span><span class="nx">info</span><span class="p">.</span><span class="nx">width</span><span class="p">).</span><span class="nx">height</span><span class="p">(</span><span class="nx">info</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
            <span class="c1">// 将添加标签的表单定位在选区的右边</span>
            <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#form-add-tag&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">({</span>
                <span class="s1">&#39;left&#39;</span><span class="o">:</span> <span class="nx">i</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="nx">i</span><span class="p">.</span><span class="nx">width</span> <span class="o">+</span> <span class="mi">10</span><span class="p">,</span>
                <span class="s1">&#39;top&#39;</span><span class="o">:</span> <span class="nx">i</span><span class="p">.</span><span class="nx">top</span>
            <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">});</span>
    <span class="c1">// 拖动选区</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#select-area&#39;</span><span class="p">).</span><span class="nx">mousedown</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">dnr</span><span class="p">.</span><span class="nx">drag</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="c1">// 调整选区大小</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#select-area-box span&#39;</span><span class="p">).</span><span class="nx">mousedown</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">dnr</span><span class="p">.</span><span class="nx">resize</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">className</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;-resize&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">));</span>
    <span class="p">});</span>
    <span class="c1">// 在图片上点击一下,开始获取选区</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#photo-wrapper img&#39;</span><span class="p">).</span><span class="nx">mousedown</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">is_started</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="nx">is_started</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">left</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">pageX</span> <span class="o">-</span> <span class="nx">origin</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="mi">50</span> <span class="o">-</span> <span class="mi">7</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">top</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">pageY</span> <span class="o">-</span> <span class="nx">origin</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="mi">50</span> <span class="o">-</span> <span class="mi">7</span><span class="p">;</span>
        <span class="nx">info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;left&#39;</span><span class="o">:</span> <span class="nx">left</span> <span class="o">+</span> <span class="mi">7</span><span class="p">,</span>
            <span class="s1">&#39;top&#39;</span><span class="o">:</span> <span class="nx">top</span> <span class="o">+</span> <span class="mi">7</span><span class="p">,</span>
            <span class="s1">&#39;width&#39;</span><span class="o">:</span> <span class="mi">100</span><span class="p">,</span>
            <span class="s1">&#39;height&#39;</span><span class="o">:</span> <span class="mi">100</span>
        <span class="p">};</span>
        <span class="nx">photoTag</span><span class="p">.</span><span class="nx">show</span><span class="p">(</span><span class="nx">info</span><span class="p">.</span><span class="nx">left</span><span class="p">,</span> <span class="nx">info</span><span class="p">.</span><span class="nx">top</span><span class="p">,</span> <span class="nx">info</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">info</span><span class="p">.</span><span class="nx">height</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#form-add-tag&#39;</span><span class="p">).</span><span class="nx">show</span><span class="p">().</span><span class="nx">css</span><span class="p">({</span>
            <span class="s1">&#39;left&#39;</span><span class="o">:</span> <span class="nx">left</span> <span class="o">+</span> <span class="mi">100</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">10</span><span class="p">,</span>
            <span class="s1">&#39;top&#39;</span><span class="o">:</span> <span class="nx">top</span>
        <span class="p">});</span>
    <span class="p">});</span>
    <span class="c1">// 鼠标进入图片内时,显示选区</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#photo-wrapper img&#39;</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;mouseenter&#39;</span><span class="p">,</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">is_started</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="nx">photoTag</span><span class="p">.</span><span class="nx">show</span><span class="p">(</span><span class="nx">info</span><span class="p">.</span><span class="nx">left</span><span class="p">,</span> <span class="nx">info</span><span class="p">.</span><span class="nx">top</span><span class="p">,</span> <span class="nx">info</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">info</span><span class="p">.</span><span class="nx">height</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="c1">// 确定添加一个标签,或取消</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#btn-add-tag, #btn-cancel&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">==</span> <span class="s1">&#39;btn-cancel&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#form-add-tag, #select-area-box&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
            <span class="nx">is_started</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#tag-name&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">())</span> <span class="p">{</span>
            <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;标签名不能为空！&#39;</span><span class="p">);</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="c1">// 添加标签</span>
        <span class="nx">photoTag</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#tag-name&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#tag-value&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span> <span class="nx">info</span><span class="p">.</span><span class="nx">left</span><span class="p">,</span> <span class="nx">info</span><span class="p">.</span><span class="nx">top</span><span class="p">,</span> <span class="nx">info</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">info</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
        <span class="c1">// 隐藏选区和表单</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#form-add-tag, #select-area-box&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
        <span class="nx">is_started</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">});</span>
    <span class="nx">photoTag</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>


<h3>Html代码：</h3>
<div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;enclose-wrapper&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;photo-wrapper&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;asp:Image</span> <span class="na">ID=</span><span class="s">&quot;ImgPhoto&quot;</span> <span class="na">Visible=</span><span class="s">&quot;false&quot;</span> <span class="na">runat=</span><span class="s">&quot;server&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div&gt;</span>
    <span class="nt">&lt;ul</span> <span class="na">id=</span><span class="s">&quot;tag-list&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/ul&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;select-area-box&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;select-area&quot;</span><span class="nt">&gt;</span> <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;</span> <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;form-add-tag&quot;</span> <span class="na">style=</span><span class="s">&quot;display: none;&quot;</span><span class="nt">&gt;</span> 名称：
    <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">&quot;tag-name&quot;</span> <span class="na">name=</span><span class="s">&quot;tag-name&quot;</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="nt">/&gt;</span>
</pre></div>


<p>数值：</p>
<p><input id="tag-value" name="tag-value" type="text" /></p>
<p><button id="btn-add-tag" type="button"> 确认</button></p>
<p><button id="btn-cancel" type="button"> 取消</button></p>
</div>

</div>

<p>这边的主要修改在于把框子的右边的内容增加为名称和数值，方便数据的识别。</p>
<h3>后台ASP.NET文件读取</h3>
<div class="highlight"><pre><span class="n">string</span><span class="p">[]</span> <span class="n">fields</span> <span class="o">=</span> <span class="n">Request</span><span class="p">.</span><span class="n">Params</span><span class="p">.</span><span class="n">GetValues</span><span class="p">(</span><span class="s">&quot;photoField&quot;</span><span class="p">);</span>
</pre></div>


<p>这里呢，由于上传的元素<code>name</code>相同，都是<code>photoField</code>，所以通过<code>Params.GetValues()</code>就可以取出<code>string</code>数组，这样就
能获取所有数据了。数据格式是"<code>ddl:小楠,x:98.88333129882812,y:146,width:100,height:100</code>"这种形式，依靠
","分割。</p>
<h3>相关下载</h3>
<p><a href="http://upload-log4d.qiniudn.com/2009/09/DragResize.js">DragResize.js</a>
<a href="http://upload-log4d.qiniudn.com/2009/09/template.js">template.js</a>
<a href="http://upload-log4d.qiniudn.com/2009/09/css.css">css.css</a></p>
            </div>
            <!-- /.entry-content -->
    <hr />
    <section class="comments" id="comments">
        <h2>Comments</h2>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'log4d'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
        </script>
		<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
		<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    

    </section>
        </article>
    </section>

        </div>
        <div class="col-lg-3 well well-sm" id="sidebar">
<aside>
    <section>
        <ul class="list-group list-group-flush">
                <li class="list-group-item"><h4><i class="icon-home icon-large"></i>Social</h4></li>
                    <li class="list-group-item"><a href="http://twitter.com/alswl"><i
                            class="icon-twitter-sign icon-large"></i>twitter
                    </a></li>
                    <li class="list-group-item"><a href="https://github.com/alswl"><i
                            class="icon-github-sign icon-large"></i>github
                    </a></li>
                    <li class="list-group-item"><a href="http://weibo.com/alswlx"><i
                            class="icon-weibo-sign icon-large"></i>weibo
                    </a></li>


                <li class="list-group-item"><h4><i class="icon-home icon-large"></i>Categories</h4></li>
                    <li class="list-group-item">
                        <a href="/category/c/">
                            <i class="icon-folder-open icon-large"></i>C
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="/category/cheng-xu-ren-sheng/">
                            <i class="icon-folder-open icon-large"></i>程序人生
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="/category/delphibian-cheng/">
                            <i class="icon-folder-open icon-large"></i>Delphi编程
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="/category/dotnet/">
                            <i class="icon-folder-open icon-large"></i>dotNet
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="/category/flashbian-cheng/">
                            <i class="icon-folder-open icon-large"></i>Flash编程
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="/category/gan-wu/">
                            <i class="icon-folder-open icon-large"></i>感悟
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="/category/gong-yu-shan-qi-shi-bi-xian-li-qi-qi/">
                            <i class="icon-folder-open icon-large"></i>工欲善其事必先利其器
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="/category/guan-zhu-hu-lian-wang/">
                            <i class="icon-folder-open icon-large"></i>关注互联网
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="/category/java/">
                            <i class="icon-folder-open icon-large"></i>Java
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="/category/ji-zhu-da-ren/">
                            <i class="icon-folder-open icon-large"></i>技术达人
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="/category/jian-zhan/">
                            <i class="icon-folder-open icon-large"></i>建站
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="/category/jian-zhan-xin-de/">
                            <i class="icon-folder-open icon-large"></i>建站心得
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="/category/linuxer/">
                            <i class="icon-folder-open icon-large"></i>Linuxer
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="/category/mei-shi-peng-ren/">
                            <i class="icon-folder-open icon-large"></i>美食|烹饪
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="/category/microsoft-net/">
                            <i class="icon-folder-open icon-large"></i>Microsoft .Net
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="/category/net-zong-he-ji-zhu/">
                            <i class="icon-folder-open icon-large"></i>.Net, 综合技术
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="/category/phpbian-cheng/">
                            <i class="icon-folder-open icon-large"></i>PHP编程
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="/category/pythonbian-cheng/">
                            <i class="icon-folder-open icon-large"></i>Python编程
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="/category/qian-duan/">
                            <i class="icon-folder-open icon-large"></i>前端
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="/category/qing-chun-de-cai-hong/">
                            <i class="icon-folder-open icon-large"></i>青春的彩虹
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="/category/ri-ji/">
                            <i class="icon-folder-open icon-large"></i>日记
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="/category/ruan-jian-kai-fa-he-xiang-mu-guan-li/">
                            <i class="icon-folder-open icon-large"></i>软件开发和项目管理
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="/category/ruby-bian-cheng/">
                            <i class="icon-folder-open icon-large"></i>Ruby 编程
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="/category/shi-jue-she-ji/">
                            <i class="icon-folder-open icon-large"></i>视觉设计
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="/category/sui-sui-nian/">
                            <i class="icon-folder-open icon-large"></i>碎碎念
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="/category/webqian-duan/">
                            <i class="icon-folder-open icon-large"></i>Web前端
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="/category/wu-hua-ba-men/">
                            <i class="icon-folder-open icon-large"></i>五花八门
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="/category/xing-neng/">
                            <i class="icon-folder-open icon-large"></i>性能
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="/category/xue-hai-wu-ya/">
                            <i class="icon-folder-open icon-large"></i>学海无涯
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="/category/yi-dong-shou-chi/">
                            <i class="icon-folder-open icon-large"></i>移动手持
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="/category/yu-le/">
                            <i class="icon-folder-open icon-large"></i>娱乐
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="/category/zong-he-ji-zhu/">
                            <i class="icon-folder-open icon-large"></i>综合技术
                        </a>
                    </li>

        </ul>
    </section>
</aside>        </div>
    </div>
</div>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="/theme/js/respond.min.js"></script>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'log4d'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
</body>
</html>